import test
import torch

import hastypy.opt.cuda.sigpy.gridding as grid
import hastypy.opt.cuda.sigpy.interp_linops as intlinops
import hastypy.opt.cuda.sigpy.dcf as dcf

import numpy as np
import cupy as cp

nx = 32
ny = 32
nz = 32

coord = 15*np.array([[6.85081111e-01, 5.31860962e-01, 3.50695600e-01, 1.85645058e-01,
        2.38764787e-01, 9.53831853e-01, 4.83364196e-01, 6.47238539e-01,
        7.87289642e-01, 9.38476912e-01, 3.17161583e-01, 1.98068141e-01,
        2.40196574e-02, 7.76561945e-01, 4.28726222e-01, 1.10343773e-01,
        7.89002819e-01, 8.03004227e-01, 5.80608257e-01, 9.02104215e-01,
        2.12929828e-01, 7.99949735e-01, 2.86043930e-01, 4.92059783e-01,
        7.91048585e-01, 9.09405893e-02, 8.10315076e-01, 7.49101780e-03,
        6.60625544e-01, 3.03429600e-01, 8.85917892e-01, 8.79186388e-01,
        5.44077949e-01, 4.79584652e-02, 3.46088271e-01, 1.26603521e-01,
        6.30778254e-01, 9.49282244e-01, 1.05996825e-01, 6.02191526e-01,
        8.22275074e-04, 2.63499637e-01, 8.59367968e-02, 7.00191942e-01,
        5.71404711e-01, 3.43649780e-01, 1.83051487e-02, 2.24701191e-01,
        6.92150108e-01, 6.78639215e-01, 3.51135725e-01, 4.10107641e-02,
        7.27791701e-01, 9.07291244e-01, 8.04007413e-01, 7.24379540e-01,
        5.42513396e-01, 3.18074423e-01, 5.05654668e-01, 1.68151627e-01,
        6.33158939e-01, 1.30500454e-01, 4.05531364e-01, 3.24980668e-01,
        9.01322298e-01, 7.73858766e-01, 2.36917899e-01, 9.49597213e-01,
        8.91613503e-01, 6.17638619e-01, 7.00316562e-02, 8.74985254e-01,
        1.23882689e-01, 8.74313295e-01, 5.79120925e-01, 8.91448383e-01,
        4.89052160e-01, 4.05039705e-01, 4.89789477e-01, 5.63990766e-01,
        5.47916333e-01, 4.03745790e-01, 4.88022149e-01, 4.27733557e-01,
        3.53557299e-01, 2.75842967e-01, 8.06512218e-01, 2.15570990e-01,
        9.52495562e-01, 3.21117711e-02, 4.75956134e-01, 9.29417640e-01,
        6.89926985e-01, 8.45939877e-01, 6.56859245e-01, 1.42209195e-01,
        7.98273869e-01, 1.57663599e-01, 5.62988222e-01, 3.49178414e-01],
       [9.35004477e-01, 2.99260103e-01, 8.95509417e-01, 4.43941981e-01,
        3.38847680e-01, 3.51700776e-01, 1.77782996e-01, 8.69591641e-01,
        4.04728284e-01, 7.75587212e-01, 6.41263732e-01, 1.24206069e-02,
        1.87253935e-01, 7.54694348e-01, 1.19882824e-03, 5.07811726e-01,
        1.26356698e-01, 7.58182954e-01, 1.46199597e-01, 1.98843199e-01,
        8.72558515e-01, 3.60923258e-02, 4.57781489e-01, 4.33364686e-01,
        2.56076706e-01, 7.49248822e-01, 9.84046385e-01, 7.11440857e-01,
        2.65437982e-01, 3.72485976e-01, 2.19958047e-02, 7.92645305e-01,
        5.68941171e-01, 6.15274110e-01, 3.58511459e-01, 7.61160913e-01,
        4.29249915e-01, 1.22294266e-01, 4.58313379e-01, 1.40482790e-01,
        1.87044787e-01, 4.06467007e-01, 4.83272643e-01, 4.58366339e-01,
        9.66265012e-02, 2.90526075e-01, 3.47981571e-01, 9.26083988e-01,
        9.83630159e-01, 7.25428922e-01, 8.13033951e-01, 6.54520389e-01,
        8.68118662e-01, 1.41416892e-01, 5.02131710e-01, 5.88726540e-01,
        6.84494219e-02, 5.11932562e-01, 2.01056350e-01, 4.34052424e-01,
        8.84053903e-01, 1.04104245e-01, 7.03189747e-01, 4.37379131e-02,
        4.23689244e-01, 6.48297104e-01, 1.15981747e-01, 7.94920864e-01,
        9.38411207e-01, 9.41977903e-01, 5.48713286e-01, 5.37074226e-01,
        5.04863797e-01, 3.02991571e-01, 9.45117964e-01, 9.58313010e-01,
        5.57833210e-01, 2.47260757e-01, 8.72011595e-03, 2.22031654e-01,
        3.18960031e-01, 1.49775979e-01, 7.95028139e-01, 8.29739237e-02,
        4.12146358e-01, 2.93619101e-01, 2.12775817e-01, 9.59747179e-01,
        8.21367372e-01, 4.72681132e-01, 3.52896723e-01, 7.84551908e-01,
        9.83249975e-01, 9.99419240e-01, 7.12758674e-01, 5.96144407e-01,
        5.49585504e-01, 1.31086615e-01, 6.56076220e-01, 3.43686190e-01],
       [7.99664432e-01, 7.73512524e-01, 8.62122591e-01, 6.22438255e-01,
        8.79617159e-01, 4.51784041e-01, 6.40598678e-02, 4.08321215e-01,
        4.63494774e-01, 8.95071980e-01, 4.80202958e-01, 9.19972181e-01,
        5.92461266e-01, 9.34078516e-01, 2.48723207e-01, 3.74989724e-01,
        8.94452719e-02, 3.02354996e-01, 6.20128934e-01, 5.99354687e-01,
        1.22425030e-01, 5.80492149e-01, 2.12191673e-01, 8.74369682e-01,
        2.22050283e-02, 3.52408762e-01, 6.91610996e-01, 9.43190968e-01,
        9.51464021e-01, 6.93984065e-01, 2.52689574e-01, 3.61618987e-01,
        6.69408092e-01, 2.09899991e-01, 9.36245551e-01, 3.12204030e-01,
        3.89534197e-01, 6.02511583e-01, 3.74129472e-01, 2.57242180e-01,
        5.78337815e-01, 8.09662558e-01, 6.98551474e-01, 7.09253155e-01,
        9.76737104e-01, 7.27552698e-01, 4.01707072e-01, 1.43984010e-01,
        9.64336774e-03, 8.63388838e-01, 9.71512860e-01, 2.45929998e-01,
        5.13978852e-01, 9.24924978e-01, 7.78092661e-01, 7.54319972e-01,
        7.82237261e-01, 5.84688796e-01, 6.95881113e-01, 1.90821095e-01,
        9.86623517e-01, 1.61851162e-03, 9.54373852e-01, 4.58731979e-01,
        9.83415644e-01, 3.11460790e-01, 6.73645879e-02, 3.22860444e-01,
        7.92762229e-01, 7.89612817e-01, 1.21371013e-01, 9.10825614e-01,
        1.26169638e-02, 3.55984245e-01, 6.55577008e-01, 4.62490767e-01,
        1.49353494e-01, 1.04982516e-01, 6.13590321e-02, 5.78943669e-01,
        5.53078553e-01, 9.98560293e-01, 6.79770596e-01, 8.07515704e-01,
        2.11217435e-01, 2.94101511e-01, 7.33173897e-01, 1.78528710e-01,
        5.11553719e-01, 4.45366223e-01, 3.05228335e-01, 3.16702008e-01,
        3.16890621e-01, 8.02896419e-01, 1.09136000e-02, 7.77609300e-01,
        9.01199967e-01, 9.77390755e-01, 5.96348048e-01, 5.68357080e-02]])
coord = torch.tensor(coord)


#G = intlinops.Gridding((32,32,32), coord, param=8, width=4)
#w = cp.ones((coord.shape[0],), dtype=cp.float32)
#Gw = G * w

w = dcf.pipe_menon_dcf(coord, (nx,ny,nz), max_iter=10).numpy()

print(w)
